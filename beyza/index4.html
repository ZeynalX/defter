<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyza Haftalık Ders Programı</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Crimson+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        :root {
            /* Renk Paleti - iOS Glassy & Earthy */
            --bg-gradient-start: #f3e7e9;
            --bg-gradient-end: #e3eeff;
            
            /* Cam Efektleri */
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: 1px solid rgba(255, 255, 255, 0.5);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            --active-glass-bg: rgba(255, 255, 255, 0.9);
            
            /* Metin Renkleri */
            --text-primary: #4a3b32;
            --text-secondary: #795548;
            --accent-color: #8d6e63;
            
            /* Etkinlik Renkleri (Daha pastel) */
            --event-break: #e1f5fe;
            --event-religious: #e8f5e9;
            --event-official: #fce4ec;
            --event-school-day: #efebe9;
            --event-special-day: #f3e5f5;

            /* Boyutlar */
            --radius-large: 20px;
            --radius-medium: 16px;
            --radius-small: 12px;
            
            --font-size-body: clamp(0.9rem, 1.5vw, 1.05rem);
            --font-size-small: clamp(0.75rem, 1.2vw, 0.85rem);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Crimson Pro', serif;
            color: var(--text-primary);
            /* Hareketli ve yumuşak arka plan */
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); 
            background-attachment: fixed;
            padding-bottom: 100px;
            font-size: var(--font-size-body);
            min-height: 100vh;
        }

        /* Arka plana şık bir "blob" efekti ekleyelim (iOS tarzı duvar kağıdı hissi) */
        body::before {
            content: '';
            position: fixed;
            top: -10%;
            left: -10%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle at 50% 10%, #e6dee9 0%, transparent 60%),
                        radial-gradient(circle at 10% 80%, #d7ccc8 0%, transparent 50%),
                        radial-gradient(circle at 90% 50%, #e0f7fa 0%, transparent 50%);
            z-index: -1;
            filter: blur(60px);
        }

        /* --- CAM (GLASS) STİLLERİ --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: var(--radius-large);
        }

        header {
            position: sticky;
            top: 10px;
            z-index: 1000;
            margin: 10px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between; /* İsim solda, Navigasyon sağda/ortada */
            position: relative;
        }
        
        .user-name {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            background: rgba(255,255,255,0.5);
            padding: 5px 12px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.6);
            white-space: nowrap;
        }

        .week-navigation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-grow: 1;
            position: relative;
        }

        header h1 {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: var(--radius-small);
            transition: all 0.2s ease;
            background: rgba(255,255,255,0.4);
        }
        header h1:hover { background: rgba(255,255,255,0.8); transform: scale(1.02); }
        header h1::after { content: 'expand_more'; font-family: 'Material Icons'; font-size: 1.1em; opacity: 0.6; }

        .nav-button {
            background: rgba(255,255,255,0.5);
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.2s;
        }
        .nav-button:hover { background: #fff; transform: scale(1.1); }
        .nav-button:disabled { opacity: 0.3; cursor: default; transform: none; }

        header h2 {
            font-size: 0.85rem;
            font-weight: 500;
            opacity: 0.7;
            margin-top: 2px;
        }

        /* DROPDOWN - iOS Popover Stili */
        .week-dropdown-content {
            display: none;
            position: absolute;
            top: 110%;
            left: 50%;
            transform: translateX(-50%) scale(0.95);
            background: rgba(255, 255, 255, 0.85); /* Daha opak */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            min-width: 260px;
            max-height: 50vh;
            overflow-y: auto;
            border-radius: var(--radius-medium);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 1002;
            padding: 5px;
            border: 1px solid rgba(255,255,255,0.6);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .week-dropdown-content.show { display: block; opacity: 1; transform: translateX(-50%) scale(1); }
        .week-dropdown-content a {
            color: var(--text-primary);
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            font-size: 0.9rem;
            border-radius: 8px;
            margin-bottom: 2px;
            transition: background 0.2s;
        }
        .week-dropdown-content a:hover { background: rgba(0,0,0,0.05); }
        .week-dropdown-content a.active { background: var(--text-secondary); color: white; }

        /* GÜN SEÇİM BAR - Segmented Control Tarzı */
        .day-nav {
            display: flex;
            justify-content: space-between;
            padding: 6px;
            position: sticky;
            top: 85px; /* Header yüksekliğine göre ayarlı */
            z-index: 999;
            margin: 0 10px 10px 10px;
            gap: 6px;
        }
        .day-nav button {
            font-family: 'Crimson Pro', serif;
            padding: 8px 4px;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            border-radius: var(--radius-small);
            background: transparent;
            color: var(--text-primary);
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.1;
        }
        .day-nav button span:first-child { font-weight: 700; font-size: 1.1rem; } /* Tarih */
        .day-nav button span:last-child { font-size: 0.75rem; opacity: 0.8; margin-top: 2px; } /* Gün */
        
        .day-nav button.active {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            color: var(--text-secondary);
            transform: translateY(-1px);
        }

        .main-container { padding: 0 10px; max-width: 1000px; margin: 0 auto; }

        /* KART STİLLERİ - iOS Widget Tarzı */
        .schedule-card {
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.5); /* Hafif transparan */
            border-radius: var(--radius-medium);
            border: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .schedule-card:active { transform: scale(0.99); }
        .schedule-card.no-body { align-items: center; justify-content: flex-start; flex-direction: row; padding: 0; }
        
        .card-header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: transparent;
            border-bottom: 1px solid rgba(121, 85, 72, 0.1);
        }
        .schedule-card.no-body .card-header { border-bottom: none; width: 100%; }

        .lesson-time {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 8px;
            background: rgba(121, 85, 72, 0.1); /* Accent color opacity */
            color: var(--text-secondary);
            font-weight: 700;
            white-space: nowrap;
        }
        .lesson-name {
            font-family: 'Cinzel Decorative', cursive;
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
        }
        .card-body {
            padding: 14px 16px;
            line-height: 1.5;
            color: var(--text-primary);
            font-size: 0.95rem;
            background: rgba(255,255,255,0.3);
        }

        /* HAFTA GÖRÜNÜMÜ */
        #week-view-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            align-items: start;
        }
        .week-view-day-title {
            font-family: 'Cinzel Decorative', cursive;
            text-align: center;
            font-size: 1rem;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.4);
            border-radius: var(--radius-small);
            color: var(--text-secondary);
            font-weight: 700;
        }

        /* ALT AKSİYON BUTONLARI - Floating Action Button */
        .action-buttons-container {
            position: fixed;
            bottom: 25px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 12px;
        }
        .action-button {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--text-secondary);
            border: 1px solid rgba(255,255,255,0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .action-button:hover { transform: translateY(-3px) scale(1.05); background: white; color: var(--text-primary); }

        /* TAKVİM MODALI - iOS Sheet Tarzı */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3); /* Darker backdrop */
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
        }
        .modal-header h2 { font-family: 'Cinzel Decorative', cursive; color: var(--text-secondary); }
        .calendar-day { 
            background: rgba(255,255,255,0.5); 
            border: none; 
            border-radius: 10px;
        }
        .calendar-day.today { box-shadow: 0 0 0 2px var(--text-secondary) inset; }
        .calendar-day.weekend-day { background: rgba(0,0,0,0.03); opacity: 0.7; }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            #week-view-container { grid-template-columns: 1fr; } /* Mobilde hafta görünümünü alt alta al */
            .day-nav { overflow-x: auto; } /* Çok dar ekranlarda kaydırma */
            .week-view-day-column { margin-bottom: 20px; }
        }

        /* PRINT */
        @media print {
            body { background: white; padding: 0; }
            body::before { display: none; }
            .glass-panel, .schedule-card { background: white; border: 1px solid #ddd; box-shadow: none; backdrop-filter: none; }
            header, .day-nav, .action-buttons-container { display: none !important; }
            #print-container { display: block !important; }
            /* ... diğer print stilleri aynı ... */
        }
        #print-container { display: none; }
    </style>
</head>
<body>
    
    <header class="glass-panel">
        <div class="header-top">
            <span class="user-name">3-A Beyza Öğrt</span>
            
            <div class="week-navigation">
                <button id="prev-week-btn" class="nav-button material-icons" onclick="showPreviousWeek()">chevron_left</button>
                <h1 id="week-title-display" onclick="toggleWeekDropdown()">Yükleniyor...</h1>
                <button id="next-week-btn" class="nav-button material-icons" onclick="showNextWeek()">chevron_right</button>
                
                <div id="week-dropdown-content" class="week-dropdown-content"></div>
            </div>
        </div>
        <h2 id="date-display"></h2>
    </header>

    <nav id="day-nav" class="day-nav glass-panel"></nav>
    
    <main id="day-view-container" class="main-container"></main>
    <main id="week-view-container" class="main-container" style="display: none;"></main>

    <div class="action-buttons-container">
        <button id="calendar-btn" class="action-button" onclick="openCalendarModal()" title="Çalışma Takvimi"><i class="material-icons">calendar_month</i></button>
        <button id="toggle-view-btn" class="action-button" onclick="toggleView()" title="Hafta Görünümü"><i class="material-icons">view_week</i></button>
        <button id="print-btn" class="action-button" onclick="printSchedule()" title="Haftalık Programı Yazdır"><i class="material-icons">print</i></button>
    </div>
    <div id="print-container"></div>

    <div id="calendar-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div class="modal-month-nav" style="display: flex; align-items: center; gap: 10px; margin: 0 auto;">
                    <button class="nav-button material-icons" id="modal-prev-month">chevron_left</button>
                    <h2 id="modal-month-year" style="margin: 0; font-size: 1.2rem;"></h2>
                    <button class="nav-button material-icons" id="modal-next-month">chevron_right</button>
                </div>
                <span class="modal-close material-icons" onclick="closeCalendarModal()" style="cursor: pointer; position: absolute; right: 20px;">close</span>
            </div>

            <div id="calendar-grid-header" class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 10px;"></div>
            <div id="calendar-grid-body" class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;"></div>

            <div id="calendar-legend" style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; font-size: 0.75rem;"></div>
            <div id="calendar-footer-info" class="calendar-footer-info" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 0.75rem;"></div>

        </div>
    </div>

    <script>
        // --- GLOBAL DEĞİŞKENLER ---
        let finalSchedule = {};
        let currentWeekIndex = 0;
        let currentDayId = 'pazartesi';
        let isWeekViewActive = false;
        let allWeeksData = [];
        const dayOrder = { pazartesi: "Pazartesi", sali: "Salı", carsamba: "Çarşamba", persembe: "Perşembe", cuma: "Cuma" };

        // Yan menü değişkenleri silindi
        const dayNav = document.getElementById('day-nav'),
            dayViewContainer = document.getElementById('day-view-container'),
            weekViewContainer = document.getElementById('week-view-container'),
            weekTitleDisplay = document.getElementById('week-title-display'),
            dateDisplay = document.getElementById('date-display'),
            prevWeekBtn = document.getElementById('prev-week-btn'),
            nextWeekBtn = document.getElementById('next-week-btn'),
            weekDropdownContent = document.getElementById('week-dropdown-content');

        let modalCurrentDate = new Date(2025, 8, 1); 
        const calendarModal = document.getElementById('calendar-modal');
        const modalMonthYear = document.getElementById('modal-month-year');
        const calendarGridHeader = document.getElementById('calendar-grid-header');
        const calendarGridBody = document.getElementById('calendar-grid-body');
        const calendarLegend = document.getElementById('calendar-legend');
        const calendarFooterInfo = document.getElementById('calendar-footer-info');

        const TR_MONTH_NAMES = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
        const TR_DAY_NAMES_SHORT = ["Pzt", "Sal", "Çar", "Per", "Cum", "Cmt", "Paz"];
        const TR_DAY_ID_MAP = ['pazar', 'pazartesi', 'sali', 'carsamba', 'persembe', 'cuma', 'cumartesi'];

        // Takvim dataları (önceki koddan aynen alındı)
        const academicCalendarRanges = [
            { start: "2025-11-10", end: "2025-11-14", type: "break", label: "I. Dönem Ara Tatil" },
            { start: "2026-01-19", end: "2026-01-30", type: "break", label: "Yarıyıl Tatili" },
            { start: "2026-03-16", end: "2026-03-20", type: "break", label: "II. Dönem Ara Tatil" },
            { start: "2026-03-26", end: "2026-03-29", type: "religious", label: "Ramazan Bayramı" },
            { start: "2026-05-26", end: "2026-05-30", type: "religious", label: "Kurban Bayramı" },
            { start: "2025-09-09", end: "2025-09-12", type: "special-day", label: "15 Temmuz Demokrasi ve Millî Birlik Günü Anma" },
            { start: "2025-09-15", end: "2025-09-19", type: "special-day", label: "İlköğretim Haftası" },
            { start: "2025-09-29", end: "2025-10-05", type: "special-day", label: "Disleksi Haftası" },
            { start: "2025-10-07", end: "2025-10-12", type: "special-day", label: "Ahilik Kültürü Haftası" },
            { start: "2025-10-28", end: "2025-11-03", type: "special-day", label: "Kızılay Haftası" },
            { start: "2025-11-01", end: "2025-11-08", type: "special-day", label: "Lösemili Çocuklar Haftası" },
            { start: "2025-11-03", end: "2025-11-09", type: "special-day", label: "Organ Bağışı ve Nakli Haftası" },
            { start: "2025-11-10", end: "2025-11-16", type: "special-day", label: "Atatürk Haftası" },
            { start: "2025-11-20", end: "2025-11-22", type: "special-day", label: "Ağız ve Diş Sağlığı Haftası" },
            { start: "2025-11-24", end: "2025-11-27", type: "special-day", label: "Ağız ve Diş Sağlığı Haftası" },
            { start: "2025-12-06", end: "2025-12-14", type: "special-day", label: "Mevlana Haftası" },
            { start: "2025-12-08", end: "2025-12-14", type: "special-day", label: "İnsan Hakları ve Demokrasi Haftası" },
            { start: "2025-12-12", end: "2025-12-18", type: "special-day", label: "Tutum, Yatırım ve Türk Malları Haftası" },
            { start: "2025-12-20", end: "2025-12-27", type: "special-day", label: "Mehmet Akif Ersoy'u Anma Haftası" },
            { start: "2026-01-05", end: "2026-01-11", type: "special-day", label: "Enerji Tasarrufu Haftası" },
            { start: "2026-02-23", end: "2026-03-01", type: "special-day", label: "Vergi Haftası" },
            { start: "2026-02-23", end: "2026-03-01", type: "special-day", label: "Yeşilay Haftası" },
            { start: "2026-03-02", end: "2026-03-08", type: "special-day", label: "Girişimcilik Haftası" },
            { start: "2026-03-08", end: "2026-03-14", type: "special-day", label: "Bilim ve Teknoloji Haftası" },
            { start: "2026-03-14", end: "2026-03-15", type: "special-day", label: "Tüketiciyi Koruma Haftası" },
            { start: "2026-03-16", end: "2026-03-17", type: "special-day", label: "Tüketiciyi Koruma Haftası" },
            { start: "2026-03-16", end: "2026-03-21", type: "special-day", label: "Türk Dünyası ve Toplulukları Haftası" },
            { start: "2026-03-21", end: "2026-03-26", type: "special-day", label: "Orman Haftası" },
            { start: "2026-03-22", end: "2026-03-24", type: "special-day", label: "Yaşlılar Haftası" },
            { start: "2026-03-30", end: "2026-04-05", type: "special-day", label: "Kütüphaneler Haftası" },
            { start: "2026-04-01", end: "2026-04-05", type: "special-day", label: "Kanser Haftası" },
            { start: "2026-04-07", end: "2026-04-13", type: "special-day", label: "Dünya Sağlık Günü/Dünya Sağlık Haftası" },
            { start: "2026-04-14", end: "2026-04-19", type: "special-day", label: "Turizm Haftası" },
            { start: "2026-05-04", end: "2026-05-10", type: "special-day", label: "Bilişim Haftası" },
            { start: "2026-05-04", end: "2026-05-10", type: "special-day", label: "İş Sağlığı ve Güvenliği Haftası" },
            { start: "2026-05-04", end: "2026-05-10", type: "special-day", label: "Trafik ve İlkyardım Haftası" },
            { start: "2026-05-09", end: "2026-05-16", type: "special-day", label: "Engelliler Haftası" },
            { start: "2026-05-11", end: "2026-05-16", type: "special-day", label: "Vakıflar Haftası" },
            { start: "2026-05-18", end: "2026-05-24", type: "special-day", label: "Müzeler Haftası" },
            { start: "2026-06-01", end: "2026-06-07", type: "special-day", label: "Hayat Boyu Öğrenme Haftası" },
            { start: "2026-06-08", end: "2026-06-14", type: "special-day", label: "Çevre Koruma Haftası" }
        ];

        const academicCalendarSingleDays = {
            "2025-09-08": { type: "school-day", label: "Ders Yılı Başlangıcı" },
            "2026-01-16": { type: "school-day", label: "I. Dönem Ders Yılı Bitişi" },
            "2026-02-02": { type: "school-day", label: "II. Dönem Ders Yılı Başlangıcı" },
            "2026-06-26": { type: "school-day", label: "II. Dönem Ders Yılı Bitişi" },
            "2025-10-29": { type: "official", label: "Cumhuriyet Bayramı" },
            "2026-04-23": { type: "official", label: "Ulusal Egemenlik ve Çocuk Bayramı" },
            "2026-05-19": { type: "official", label: "Atatürk'ü Anma ve Gençlik ve Spor Bayramı" },
            "2025-10-02": { type: "special-day", label: "Dünya Disleksi Günü" },
            "2025-10-04": { type: "special-day", label: "Hayvanları Koruma Günü" },
            "2025-10-13": { type: "special-day", label: "Dünya Afet Azaltma Günü" },
            "2025-10-24": { type: "special-day", label: "Birleşmiş Milletler Günü" },
            "2025-11-12": { type: "special-day", label: "Afet Eğitimi Hazırlık Günü" },
            "2025-11-14": { type: "special-day", label: "Dünya Diyabet Günü" },
            "2025-11-20": { type: "special-day", label: "Dünya Çocuk Hakları Günü" },
            "2025-11-20": { type: "special-day", label: "Dünya Felsefe Günü" },
            "2025-11-24": { type: "special-day", label: "Öğretmenler Günü" },
            "2025-11-24": { type: "special-day", label: "Ağız ve Diş Sağlığı Günü" },
            "2025-12-03": { type: "special-day", label: "Dünya Engelliler Günü" },
            "2025-12-04": { type: "special-day", label: "Dünya Madenciler Günü" },
            "2025-12-05": { type: "special-day", label: "Türk Kadınına Seçme ve Seçilme Hakkı" },
            "2025-12-25": { type: "special-day", label: "Gaziantep'in Kurtuluşu" },
            "2026-02-28": { type: "special-day", label: "Sivil Savunma Günü" },
            "2026-03-08": { type: "special-day", label: "Dünya Kadınlar Günü" },
            "2026-03-12": { type: "special-day", label: "İstiklâl Marşı'nın Kabulü" },
            "2026-03-18": { type: "special-day", label: "Şehitler Günü" },
            "2026-03-27": { type: "special-day", label: "Dünya Tiyatrolar Günü" },
            "2026-04-02": { type: "special-day", label: "Dünya Otizm Farkındalık Günü" },
            "2026-04-07": { type: "special-day", label: "Kişisel Verileri Koruma Günü" },
            "2026-04-26": { type: "special-day", label: "Dünya Fikri Mülkiyet Günü" },
            "2026-04-29": { type: "special-day", label: "Kut'ül Amâre Zaferi" },
            "2026-05-09": { type: "special-day", label: "Anneler Günü" },
            "2026-05-25": { type: "special-day", label: "Etik Günü" },
            "2026-05-29": { type: "special-day", label: "İstanbul'un Fethi" },
            "2026-06-21": { type: "special-day", label: "Babalar Günü" }
        };

        const legendData = {
            "Ara Tatil (Mavi)": "event-break",
            "Dini Bayram (Yeşil)": "event-religious",
            "Resmi Tatil (Pembe)": "event-official",
            "Belirli Gün/Hafta (Mor)": "event-special-day",
            "Okul Açılış/Kapanış": "event-school-day",
            "Hafta Sonu (Gri)": "weekend-day"
        };

        const longLabelsMap = {};

        // Dropdown'u aç/kapa
        function toggleWeekDropdown() {
            weekDropdownContent.classList.toggle('show');
        }

        // Dropdown dışına tıklanınca kapat
        window.onclick = function(event) {
            if (!event.target.matches('#week-title-display') && !event.target.closest('#week-title-display')) {
                if (weekDropdownContent.classList.contains('show')) {
                    weekDropdownContent.classList.remove('show');
                }
            }
        }

        async function initializeSchedule() {
            try {
                 const [timetableRes, curriculumRes, weeksRes] = await Promise.all([
                    fetch('ders-programi.json'),
                    fetch('kazanimlar.json'),
                    fetch('haftalar.json')
                ]);
                const timetable = await timetableRes.json();
                const curriculum = await curriculumRes.json();
                allWeeksData = await weeksRes.json();

                const lessonCounters = {};
                for (const subject in curriculum) { lessonCounters[subject] = 0; }

                allWeeksData.forEach((week, index) => {
                    const weekKey = `week${index + 1}`;
                    finalSchedule[weekKey] = { name: week.name, dates: week.dates, days: {} };
                    for (const day in timetable) {
                        finalSchedule[weekKey].days[day] = [];
                        timetable[day].forEach((lessonName, lessonIndex) => {
                            let objective = "Kazanım veya etkinlik belirtilmemiş.";
                            if (curriculum[lessonName] && lessonCounters[lessonName] < curriculum[lessonName].length) {
                                objective = curriculum[lessonName][lessonCounters[lessonName]];
                                lessonCounters[lessonName]++;
                            }
                            finalSchedule[weekKey].days[day].push({ time: `${lessonIndex + 1}. Ders`, name: lessonName, objective: objective });
                        });
                    }
                });

                //populateSideNavMenu(allWeeksData); // ARTIK YOK
                populateWeekDropdown(allWeeksData); 
                if (window.innerWidth > window.innerHeight) { isWeekViewActive = true; }
                const target = findCurrentWeekAndDay(allWeeksData);
                currentDayId = target.dayId;
                displayWeek(target.weekIndex);

                document.getElementById('modal-prev-month').addEventListener('click', () => {
                    modalCurrentDate.setMonth(modalCurrentDate.getMonth() - 1);
                    renderDynamicCalendar();
                });
                document.getElementById('modal-next-month').addEventListener('click', () => {
                    modalCurrentDate.setMonth(modalCurrentDate.getMonth() + 1);
                    renderDynamicCalendar();
                });
                calendarModal.addEventListener('click', (e) => {
                    if (e.target === calendarModal) {
                        closeCalendarModal();
                    }
                });
                populateCalendarLegend();
                renderDynamicCalendar();

            } catch (error) {
                console.error('Veri dosyaları yüklenirken bir hata oluştu:', error);
                weekTitleDisplay.textContent = "Hata!";
                dateDisplay.textContent = "Veriler yüklenemedi.";
            }
        }

        // Dropdown Menüyü Doldur
        function populateWeekDropdown(weeksData) {
            weekDropdownContent.innerHTML = '';
            weeksData.forEach((week, index) => {
                const link = document.createElement('a');
                link.href = "javascript:void(0)";
                link.textContent = week.name;
                link.onclick = () => { displayWeek(index); };
                weekDropdownContent.appendChild(link);
            });
        }

        // Gün butonlarına tarih ekleme
        function populateDayNav(weekDatesString) {
            dayNav.innerHTML = '';
            const dayNames = { pazartesi: "Pzt", sali: "Sal", carsamba: "Çar", persembe: "Per", cuma: "Cum" };
            
            let startDate = null;
            if (weekDatesString) {
                const startStr = weekDatesString.split(' - ')[0];
                const fullDateStr = weekDatesString.split(' - ')[1];
                const year = fullDateStr.split(' ').pop();
                
                let startParts = startStr.split(' ');
                if (startParts.length === 2) startParts.push(year);
                
                startDate = parseTurkishDate(startParts.join(' '));
            }

            let dayIndex = 0;
            for(const dayId in dayOrder) {
                const button = document.createElement('button');
                
                let dateLabel = "";
                if (startDate) {
                    const currentDayDate = new Date(startDate);
                    currentDayDate.setDate(startDate.getDate() + dayIndex);
                    const dayNum = currentDayDate.getDate().toString().padStart(2, '0');
                    dateLabel = `${dayNum}`;
                }

                button.innerHTML = `<span>${dateLabel}</span><span>${dayNames[dayId]}</span>`;
                button.dataset.day = dayId;
                button.onclick = () => displayDay(dayId);
                dayNav.appendChild(button);
                dayIndex++;
            }
        }

        function displayWeek(weekIndex) {
            currentWeekIndex = weekIndex;
            const weekKey = `week${weekIndex + 1}`;
            const weekData = finalSchedule[weekKey];

            if (!weekData) return;

            weekTitleDisplay.textContent = weekData.name;
            dateDisplay.textContent = weekData.dates;

            const dropdownLinks = weekDropdownContent.querySelectorAll('a');
            dropdownLinks.forEach((link, idx) => {
                if (idx === weekIndex) link.classList.add('active');
                else link.classList.remove('active');
            });
            
            prevWeekBtn.disabled = weekIndex === 0;
            nextWeekBtn.disabled = weekIndex === allWeeksData.length - 1;

            populateDayNav(weekData.dates);

            if (isWeekViewActive) {
                renderWeekView();
                dayNav.style.display = 'none';
                dayViewContainer.style.display = 'none';
                weekViewContainer.style.display = 'grid';
                document.getElementById('toggle-view-btn').querySelector('i').textContent = 'view_day';
            } else {
                displayDay(currentDayId);
                dayNav.style.display = 'flex';
                dayViewContainer.style.display = 'block';
                weekViewContainer.style.display = 'none';
                document.getElementById('toggle-view-btn').querySelector('i').textContent = 'view_week';
            }
        }

        function displayDay(dayId) {
            currentDayId = dayId;
            dayViewContainer.innerHTML = '';
            const weekKey = `week${currentWeekIndex + 1}`;
            const lessons = finalSchedule[weekKey]?.days[dayId] || [];

            lessons.forEach(lesson => {
                const card = document.createElement('div');
                const isObjectiveEmpty = lesson.objective.includes("belirtilmemiş");
                
                card.className = isObjectiveEmpty ? 'schedule-card no-body' : 'schedule-card';

                const lessonNum = lesson.time.replace('. Ders', '.');
                
                let htmlContent = `
                    <div class="card-header">
                        <span class="lesson-time">${lessonNum}</span>
                        <span class="lesson-name">${lesson.name}</span>
                    </div>`;
                
                if (!isObjectiveEmpty) {
                    htmlContent += `<div class="card-body">${lesson.objective}</div>`;
                }
                
                card.innerHTML = htmlContent;
                dayViewContainer.appendChild(card);
            });

            document.querySelectorAll('.day-nav button').forEach(btn => btn.classList.toggle('active', btn.dataset.day === dayId));
        }

        function renderWeekView() {
            weekViewContainer.innerHTML = '';
            const weekKey = `week${currentWeekIndex + 1}`;
            const weekData = finalSchedule[weekKey];
            
            let startDate = null;
            if (weekData.dates) {
                 const startStr = weekData.dates.split(' - ')[0];
                 const year = weekData.dates.split(' - ')[1].split(' ').pop();
                 let startParts = startStr.split(' ');
                 if (startParts.length === 2) startParts.push(year);
                 startDate = parseTurkishDate(startParts.join(' '));
            }

            let dayIndex = 0;
            for (const dayId in dayOrder) {
                const column = document.createElement('div');
                column.className = 'week-view-day-column';
                
                let dayTitle = dayOrder[dayId];
                if (startDate) {
                     const currentDayDate = new Date(startDate);
                     currentDayDate.setDate(startDate.getDate() + dayIndex);
                     const dayNum = currentDayDate.getDate().toString().padStart(2, '0');
                     dayTitle = `${dayNum} ${dayTitle}`;
                }

                let lessonsHTML = `<h3 class="week-view-day-title">${dayTitle}</h3>`;
                const lessons = weekData.days[dayId] || [];

                lessons.forEach(lesson => {
                    const isObjectiveEmpty = lesson.objective.includes("belirtilmemiş");
                    const cardClass = isObjectiveEmpty ? 'schedule-card no-body' : 'schedule-card';
                    const lessonNum = lesson.time.replace('. Ders', '.');

                    lessonsHTML += `<div class="${cardClass}">
                        <div class="card-header">
                             <span class="lesson-time">${lessonNum}</span>
                             <span class="lesson-name">${lesson.name}</span>
                        </div>`;
                    
                    if (!isObjectiveEmpty) {
                        lessonsHTML += `<div class="card-body">${lesson.objective}</div>`;
                    }
                    
                    lessonsHTML += `</div>`;
                });
                column.innerHTML = lessonsHTML;
                weekViewContainer.appendChild(column);
                dayIndex++;
            }
        }

        function showPreviousWeek() { if (currentWeekIndex > 0) displayWeek(currentWeekIndex - 1); }
        function showNextWeek() { if (currentWeekIndex < allWeeksData.length - 1) displayWeek(currentWeekIndex + 1); }
        function toggleView() { isWeekViewActive = !isWeekViewActive; displayWeek(currentWeekIndex); }
        function handleOrientationChange() { const isLandscape = window.innerWidth > window.innerHeight; if (isWeekViewActive === isLandscape) return; toggleView(); }
        
        function printSchedule() { 
            const printContainer = document.getElementById('print-container'); 
            const weekKey = `week${currentWeekIndex + 1}`; 
            const week = finalSchedule[weekKey]; 
            let pageHeaderHTML = `<div class="print-page-header"><h1>${week.name}</h1><p>${week.dates}</p></div>`; 
            let daysHTML = '<div class="print-days-flex-container">'; 
            for (const dayId in dayOrder) { 
                daysHTML += `<div class="print-day-container"><h3 class="print-day-title">${dayOrder[dayId]}</h3>`; 
                const lessons = week.days[dayId] || []; 
                lessons.forEach(lesson => { 
                    const isObjectiveEmpty = lesson.objective.includes("belirtilmemiş");
                    const bodyClass = isObjectiveEmpty ? 'print-card-body empty' : 'print-card-body'; 
                    daysHTML += `<div class="print-card"><div class="print-card-header"><span class="print-lesson-name">${lesson.name}</span><span>${lesson.time}</span></div>`;
                    if (!isObjectiveEmpty) {
                         daysHTML += `<div class="${bodyClass}">${lesson.objective}</div>`;
                    }
                    daysHTML += `</div>`; 
                }); 
                daysHTML += `</div>`; 
            } 
            daysHTML += '</div>'; 
            printContainer.innerHTML = pageHeaderHTML + daysHTML; 
            window.print(); 
        }

        function parseTurkishDate(dateString) { 
            const m = { 'ocak': 0, 'şubat': 1, 'mart': 2, 'nisan': 3, 'mayıs': 4, 'haziran': 5, 'temmuz': 6, 'ağustos': 7, 'eylül': 8, 'ekim': 9, 'kasım': 10, 'aralık': 11 }; 
            const p = dateString.toLowerCase().split(' '); 
            if (p.length<2) return null; 
            const d=parseInt(p[0],10), mo=m[p[1]], y=p.length>2?parseInt(p[2],10):new Date().getFullYear(); 
            if(isNaN(d)||mo===undefined||isNaN(y))return null; 
            return new Date(y,mo,d); 
        };

        function findWeekIndexForDate(targetDate) { 
            if (!targetDate) return -1; 
            targetDate.setHours(0, 0, 0, 0); 
            for(let i = 0; i < allWeeksData.length; i++) { 
                const week = allWeeksData[i]; 
                const dateParts = week.dates.split(' - '); 
                if (dateParts.length !== 2) continue; 
                const endPart = dateParts[1].split(' '); 
                const year = endPart[endPart.length - 1]; 
                let startPart = dateParts[0].split(' '); 
                if (startPart.length === 2) { startPart.push(year); } 
                const startDate = parseTurkishDate(startPart.join(' ')); 
                const endDate = parseTurkishDate(dateParts[1]); 
                if (startDate && endDate) { 
                    startDate.setHours(0, 0, 0, 0); 
                    endDate.setHours(0, 0, 0, 0); 
                    if (targetDate >= startDate && targetDate <= endDate) { return i; } 
                } 
            } 
            return -1; 
        }

        function findCurrentWeekAndDay(weeksData) { 
            const today = new Date(); 
            today.setHours(0, 0, 0, 0); 
            const dayOfWeek = today.getDay(); 
            const targetDate = new Date(today); 
            if (dayOfWeek === 6) { targetDate.setDate(targetDate.getDate() + 2); } 
            else if (dayOfWeek === 0) { targetDate.setDate(targetDate.getDate() + 1); } 
            let todayDayId = TR_DAY_ID_MAP[dayOfWeek]; 
            if (dayOfWeek === 0 || dayOfWeek === 6) { todayDayId = 'pazartesi'; } 
            const weekIndex = findWeekIndexForDate(targetDate); 
            if (weekIndex !== -1) { return { weekIndex: weekIndex, dayId: todayDayId }; } 
            return { weekIndex: 0, dayId: 'pazartesi' }; 
        }

        // --- TAKVİM FONKSİYONLARI ---

        function getShortLabel(label) {
            if (!label) return '';
            let shortLabel = label;
            // (Tüm kısaltmalar aynı - kod tasarrufu için tekrar kopyalamıyorum, önceki mantıkla aynı)
            if (label === "15 Temmuz Demokrasi ve Millî Birlik Günü Anma") shortLabel = "15 Temmuz";
            else if (label.includes("Cumhuriyet Bayramı")) shortLabel = "C. Bayramı";
            // ... diğer tüm kısaltmalar ...
            else if (label.includes("Babalar Günü")) shortLabel = "Babalar G.";

            if (shortLabel !== label && !longLabelsMap[shortLabel]) {
                longLabelsMap[shortLabel] = label;
            }
            return shortLabel;
        }

        function openCalendarModal() { 
            const weekKey = `week${currentWeekIndex + 1}`; 
            const weekDates = finalSchedule[weekKey]?.dates; 
            if (weekDates) { 
                const startDateStr = weekDates.split(' - ')[0]; 
                const modalStartDate = parseTurkishDate(startDateStr); 
                if (modalStartDate) { modalCurrentDate = modalStartDate; } 
            } 
            renderDynamicCalendar(); 
            calendarModal.style.display = 'flex'; 
        }

        function navigateToDate(date) { 
            const weekIndex = findWeekIndexForDate(new Date(date.getTime())); 
            const dayOfWeek = date.getDay(); 
            const dayId = TR_DAY_ID_MAP[dayOfWeek]; 
            if (weekIndex !== -1 && dayId !== 'pazar' && dayId !== 'cumartesi') { 
                currentDayId = dayId; 
                currentWeekIndex = weekIndex; 
                if (isWeekViewActive) { toggleView(); } else { displayWeek(weekIndex); } 
                closeCalendarModal(); 
            } else { console.log("Seçilen tarih bir okul günü değil:", date); } 
        }

        function closeCalendarModal() { calendarModal.style.display = 'none'; }
        function getISODateString(date) { const year = date.getFullYear(); const month = (date.getMonth() + 1).toString().padStart(2, '0'); const day = date.getDate().toString().padStart(2, '0'); return `${year}-${month}-${day}`; }
        
        function getEventForDate(date) { 
            const dateString = getISODateString(date); 
            let events = []; 
            if (academicCalendarSingleDays[dateString]) { events.push(academicCalendarSingleDays[dateString]); } 
            academicCalendarRanges.forEach(range => { 
                const startDate = new Date(range.start + 'T00:00:00'); 
                const endDate = new Date(range.end + 'T00:00:00'); 
                const dateOnly = new Date(date.getFullYear(), date.getMonth(), date.getDate()); 
                if (dateOnly >= startDate && dateOnly <= endDate) { events.push({ type: range.type, label: range.label }); } 
            }); 
            if (events.length === 0) return null; 
            const uniqueTypes = [...new Set(events.map(e => e.type))]; 
            let uniqueEvents = uniqueTypes.map(type => { 
                const eventsOfType = events.filter(e => e.type === type); 
                const combinedLabel = eventsOfType.map(e => e.label).join(' / '); 
                return { type: type, label: combinedLabel }; 
            }); 
            uniqueEvents.sort((a, b) => { const priority = { 'break': 1, 'religious': 2, 'official': 3, 'school-day': 4, 'special-day': 5 }; return (priority[a.type] || 99) - (priority[b.type] || 99); }); 
            return uniqueEvents; 
        }

        function renderDynamicCalendar() {
            const year = modalCurrentDate.getFullYear();
            const month = modalCurrentDate.getMonth();
            modalMonthYear.textContent = `${TR_MONTH_NAMES[month]} ${year}`;
            calendarGridHeader.innerHTML = '';
            calendarGridBody.innerHTML = '';
            const shortLabelsUsedThisMonth = new Set();
            TR_DAY_NAMES_SHORT.forEach(dayName => { calendarGridHeader.innerHTML += `<div class="calendar-day-header" style="font-family: 'Cinzel Decorative', cursive; text-align: center; font-size: 0.8rem; padding: 5px; opacity: 0.7;">${dayName}</div>`; });
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            const daysInMonth = lastDayOfMonth.getDate();
            let dayOfWeek = firstDayOfMonth.getDay();
            let startOffset = (dayOfWeek === 0) ? 6 : dayOfWeek - 1;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const prevMonthEndDate = new Date(year, month, 0).getDate();
            for (let i = 0; i < startOffset; i++) { const prevMonthDay = prevMonthEndDate - startOffset + 1 + i; calendarGridBody.innerHTML += `<div class="calendar-day other-month" style="opacity: 0.3;"><span class="day-number">${prevMonthDay}</span></div>`; }
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                let classes = 'calendar-day';
                const dayOfWeekForClick = date.getDay();
                if (date.getTime() === today.getTime()) classes += ' today';
                if (dayOfWeekForClick === 0 || dayOfWeekForClick === 6) classes += ' weekend-day';
                const events = getEventForDate(date);
                let tooltipHTML = '';
                let labelHTML = '';
                let styleAttr = '';
                let primaryType = null;
                if (events && events.length > 0) {
                    const primaryEvent = events[0];
                    primaryType = primaryEvent.type;
                    classes += ' event';
                    const allLabels = events.map(e => e.label).join(' / ');
                    tooltipHTML = `<span class="tooltip">${allLabels}</span>`;
                    const shortLabel1 = getShortLabel(primaryEvent.label);
                    labelHTML = `<span class="day-label">${shortLabel1}</span>`;
                    if (longLabelsMap[shortLabel1]) shortLabelsUsedThisMonth.add(shortLabel1);
                    if (events.length > 1) {
                        const secondEvent = events[1];
                        const shortLabel2 = getShortLabel(secondEvent.label);
                        if (shortLabel1 !== shortLabel2) {
                             labelHTML += `<span class="day-label">${shortLabel2}</span>`;
                             if (longLabelsMap[shortLabel2]) shortLabelsUsedThisMonth.add(shortLabel2);
                        }
                        styleAttr = `style="background: linear-gradient(to bottom, var(--event-color-${primaryEvent.type}) 50%, var(--event-color-${secondEvent.type}) 50%);"`;
                    } else {
                        styleAttr = `style="background-color: var(--event-color-${primaryEvent.type});"`;
                    }
                }
                let onclickAttr = '';
                if (dayOfWeekForClick !== 0 && dayOfWeekForClick !== 6 && primaryType !== 'break') {
                    if (findWeekIndexForDate(date) !== -1) { onclickAttr = `onclick="navigateToDate(new Date(${year}, ${month}, ${day}))" title="Bu güne git" style="cursor: pointer;"`; } else if (!classes.includes('weekend-day')) { onclickAttr = `style="cursor: not-allowed;"`; }
                } else if (primaryType === 'break') { onclickAttr = `style="cursor: not-allowed;"`; }
                calendarGridBody.innerHTML += `<div class="${classes}" ${onclickAttr} ${styleAttr}><span class="day-number">${day}</span>${labelHTML}${tooltipHTML}</div>`;
            }
            const totalCells = startOffset + daysInMonth;
            const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7);
            for (let i = 0; i < remainingCells; i++) { calendarGridBody.innerHTML += `<div class="calendar-day other-month" style="opacity: 0.3;"><span class="day-number">${i + 1}</span></div>`; }
            let footerHTML = '';
            if (shortLabelsUsedThisMonth.size > 0) {
                 footerHTML += '<strong>Açıklamalar:</strong><ul>';
                 const sortedShortLabels = Array.from(shortLabelsUsedThisMonth).sort();
                 sortedShortLabels.forEach(shortLabel => { footerHTML += `<li><strong>${shortLabel}:</strong> ${longLabelsMap[shortLabel]}</li>`; });
                 footerHTML += '</ul>';
            }
            calendarFooterInfo.innerHTML = footerHTML;
        }

        function populateCalendarLegend() { calendarLegend.innerHTML = ''; for (const label in legendData) { const type = legendData[label]; calendarLegend.innerHTML += ` <div class="legend-item"> <div class="legend-color-box ${type}"></div> <span>${label}</span> </div> `; } }

        document.addEventListener('DOMContentLoaded', initializeSchedule);
        window.addEventListener('resize', handleOrientationChange);
    </script>
</body>
</html>
